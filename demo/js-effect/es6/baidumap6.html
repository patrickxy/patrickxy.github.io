<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=medium-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>vue-music</title>
    <style>
        #allmap {
            width: 100%;
            height: 500px;
        }
    </style>
    <!--<script src='map.js'></script>-->
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=UCVb3rkl12kd2UGTu7gSvqlp"></script>
</head>

<body>
    <div id="allmap">

    </div>
    <button type="button" id='to1'>1000</button>
    <button type="button" id='to2'>300</button>
    <!-- built files will be auto injected -->
    <script type="text/javascript">
        var style = {
            strokeColor: "blue",
            fillColor: "blue",
            strokeWeight: 2,
            fillOpacity: 0.5,
            strokeOpacity: 0.5
        };
        var map = new BMap.Map("allmap", {
            enableMapClick: false
        }); // 创建Map实例
        var points = {};
        var labelIndex = 1;
        map.centerAndZoom(new BMap.Point(108.404, 34.915), 13); // 初始化地图,设置中心点坐标和地图级别


        function showInfo(e) {
            if (e.overlay) {
                return;
            }
            labelIndex++;
            draw(e.point.lng, e.point.lat, 700, labelIndex);
            points[labelIndex] = {
                id: labelIndex,
                lng: e.point.lng,
                lat: e.point.lat
            };
        }

        function scale(r) {
            map.clearOverlays();
            Object.keys(points).forEach(id => {
                draw(points[id].lng, points[id].lat, r, id)
            })
        }

        function draw(lng, lat, r, id) {
            var point = new BMap.Point(lng, lat);
            console.log(lng);
            console.log(lat);
            var cir = new BMap.Circle(point, r, style);
            var maker = new BMap.Marker(point);
            var label = new BMap.Label('标签' + id, {
                position: point,
            });
            map.addOverlay(maker);
            map.addOverlay(label);
            map.addOverlay(cir);

            [maker, label, cir].forEach(i => {
                i.addEventListener('click', function() {
                    points[id] = null;
                    delete points[id];
                    map.removeOverlay(cir);
                    map.removeOverlay(maker);
                    map.removeOverlay(label);
                })
            })
        }
        map.addEventListener('click', showInfo)

        to1.onclick = function() {
            scale(1000)
        };
        to2.onclick = function() {
            scale(300)
        }
    </script>
</body>

</html>